worker_processes  3;

daemon off;
error_log /dev/stdout info;
pid        /pid/nginx.pid;


events {
    worker_connections  1024;
    use epoll;
}


http {
    include       mime.types;
    default_type  application/octet-stream;

    log_format  main  '$remote_addr - $remote_user [$time_local] "$request" '
                     '$status $body_bytes_sent "$http_referer" '
                     '"$http_user_agent" "$http_x_forwarded_for"';

    access_log /dev/stdout;

    sendfile        on;
    keepalive_timeout  65;

    server {
      listen PROXY_PORT_PLACEHOLDER default_server;

      resolver K8S_DNS_PLACEHOLDER;

      location / {
        proxy_pass http://HEIMDALL_SVC_PLACEHOLDER.HEIMDALL_NAMESPACE_PLACEHOLDER.svc.cluster.local:HEIMDALL_PORT_PLACEHOLDER/;
        proxy_pass_header content-type;
        proxy_pass_header Content-Type;
        proxy_set_header Authorization $http_x_heimdall_authorization;
        proxy_redirect off;
      }
    }

}